<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Impulse Mini App</title>

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, sans-serif;
  background: #f4f7fb;
}

#app {
  max-width: 420px;
  margin: auto;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.content {
  flex: 1;
  padding: 16px;
}

.card {
  background: white;
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,.05);
}

h2 {
  margin-top: 0;
}

input {
  width: 100%;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 12px;
  border: 1px solid #ddd;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  background: #5ddcff;
  font-weight: 600;
}

button:disabled {
  opacity: 0.5;
}

.tabs {
  display: flex;
  justify-content: space-around;
  background: white;
  padding: 10px 0;
}

.tabs button {
  background: none;
  border: none;
  opacity: 0.4;
}

.tabs .active {
  opacity: 1;
}
.moods span {
  font-size: 24px;
  margin-right: 6px;
}
</style>
</head>

<body>
<div id="app">
  <div class="content" id="content"></div>

  <div class="tabs">
    <button onclick="setTab('today')" id="tab-today">Today</button>
    <button onclick="setTab('impulse')" id="tab-impulse">Impulse</button>
    <button onclick="setTab('progress')" id="tab-progress">Progress</button>
    <button onclick="setTab('rewards')" id="tab-rewards">Rewards</button>
  </div>
</div>

<script>
const defaultData = {
  todayCheckIn: false,
  streak: 0,
  impulses: [],
  moodHistory: []
};

let state = {
  tab: "today",
  data: loadData()
};

function loadData() {
  const saved = localStorage.getItem("impulseApp");
  return saved ? JSON.parse(saved) : defaultData;
}

function saveData() {
  localStorage.setItem("impulseApp", JSON.stringify(state.data));
}

function setTab(tab) {
  state.tab = tab;
  render();
}

function render() {
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
  document.getElementById("tab-" + state.tab).classList.add("active");

  const c = document.getElementById("content");

  if (state.tab === "today") {
    c.innerHTML = `
      <div class="card">
        <h2>–°–µ–≥–æ–¥–Ω—è</h2>
        <p>–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?</p>
        <button ${state.data.todayCheckIn ? "disabled" : ""} onclick="checkIn()">
          ${state.data.todayCheckIn ? "–£–∂–µ –æ—Ç–º–µ—á–µ–Ω–æ" : "–û—Ç–º–µ—Ç–∏—Ç—å –¥–µ–Ω—å"}
        </button>
      </div>`;
  }

  if (state.tab === "impulse") {
    c.innerHTML = `
      <div class="card">
        <h2>–ò–º–ø—É–ª—å—Å ‚Üí –î–µ–π—Å—Ç–≤–∏–µ</h2>
        <input id="impulse" placeholder="–ß—Ç–æ —è –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª?" />
        <input id="action" placeholder="–ö–∞–∫ —è –æ—Ç–≤–µ—Ç–∏–ª?" />
        <button onclick="saveImpulse()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>`;
  }

  if (state.tab === "progress") {
    c.innerHTML = `
      <div class="card">
        <h2>–ü—Ä–æ–≥—Ä–µ—Å—Å</h2>
        <p>–°–µ—Ä–∏—è –¥–Ω–µ–π: ${state.data.streak}</p>
        <div class="moods">
          ${state.data.moodHistory.map(m => `<span>${m.mood}</span>`).join("")}
        </div>
      </div>`;
  }

  if (state.tab === "rewards") {
    c.innerHTML = `
      <div class="card">
        <h2>–ù–∞–≥—Ä–∞–¥—ã</h2>
        ${state.data.streak >= 3 ? "<p>üå± –ü–µ—Ä–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</p>" : ""}
        ${state.data.streak >= 7 ? "<p>üî• –ù–µ–¥–µ–ª—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏</p>" : ""}
        ${state.data.streak >= 21 ? "<p>üèÜ –ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞</p>" : ""}
      </div>`;
  }
}

function checkIn() {
  if (state.data.todayCheckIn) return;
  state.data.todayCheckIn = true;
  state.data.streak += 1;
  state.data.moodHistory.push({ date: Date.now(), mood: "üôÇ" });
  saveData();
  render();
}

function saveImpulse() {
  const impulse = document.getElementById("impulse").value;
  const action = document.getElementById("action").value;
  if (!impulse || !action) return;

  state.data.impulses.push({
    date: Date.now(),
    impulse,
    action
  });

  saveData();
  render();
}

render();
</script>
</body>
</html>
